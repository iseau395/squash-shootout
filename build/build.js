var app=function(e){"use strict";class t extends EngineObject{constructor(e,t){super(vec2(0,0),vec2(1.5,1),7+e,vec2(48,32),90),this.bullet_spawn=vec2(0,0),this.target=vec2(0,0),this.sprite_index=e,this.shoot_cooldown=t}setTarget(e){this.target=e}update(){super.update(),this.localAngle=Math.atan2(this.target.x-this.pos.x,this.target.y-this.pos.y)-90*PI/180}shoot(){console.error("Unimplimented")}render(){super.render()}}class s extends t{constructor(){super(0,16)}shoot(){const e=new EngineObject(this.pos.add(vec2(.5,.25).rotate(-this.localAngle)),vec2(.5,.5),0+this.sprite_index,vec2(16,16),this.localAngle);return e.velocity=vec2().setAngle(e.angle+.5*PI).normalize().divide(vec2(3,3)),e.damping=1,e}}class i extends EngineObject{constructor(e,t,s,i){super(e,s,0,i),this.last_damaged=0,this.health=t}damage(e){this.destroyed||(this.health-=e,this.color=new Color(1,0,0),this.last_damaged=time)}update(){super.update(),this.health<=0&&!this.destroyed&&this.destroy()}render(){super.render(),time-this.last_damaged>.05&&(this.color=new Color)}}class o extends i{constructor(e,t){super(e,2,vec2(1,1.5),vec2(32,48)),this.weapon=new s,this.animation_frame=0,this.sprite_frame=0,this.is_too_close=!1,this.too_close_to=vec2(),this.last_target=randVector(10).add(this.pos),this.last_move=vec2(0,0),this.shoot_counter=0,this.sprite=t,this.tileIndex=0,this.addChild(this.weapon,vec2(.6,.2),0)}isTooClose(e,t){this.is_too_close=e,this.too_close_to=t}update(){if(super.update(),this.destroyed)return;const t=e.player.pos.subtract(this.pos);this.last_target=this.last_target.lerp(e.player.pos.add(randVector(1).multiply(vec2(max(min(t.x/10,2),.5),max(min(t.y/10,2),.5)))),.02),this.weapon.setTarget(this.last_target),this.shoot_counter>0&&this.shoot_counter++,this.shoot_counter>=2*this.weapon.shoot_cooldown&&(this.shoot_counter=0),0==this.shoot_counter&&this.pos.distance(e.player.pos)<8&&l.length<400&&(l.push(this.weapon.shoot()),this.shoot_counter++),this.is_too_close?this.pos.x==this.too_close_to.x&&this.pos.y==this.too_close_to.y?this.velocity=randVector(1):this.velocity=this.pos.subtract(this.too_close_to).normalize().divide(vec2(50,50)):this.pos.distance(e.player.pos)>5?this.velocity=this.pos.subtract(e.player.pos.add(randVector(2))).normalize().divide(vec2(-30,-30)):this.velocity=vec2(0,0),this.last_move=this.last_move.lerp(this.velocity,.25),this.velocity=vec2(this.pos.x<tileCollisionSize.x/2+24-1&&this.pos.x>25?this.last_move.x:Math.abs(this.last_move.x)*-Math.sign(this.pos.x-tileCollisionSize.x/2),this.pos.y<tileCollisionSize.y/2+12-1&&this.pos.y>13.75?this.last_move.y:Math.abs(this.last_move.y)*-Math.sign(this.pos.y-tileCollisionSize.y/2))}render(){super.render(),this.tileIndex=80+this.sprite_frame+16*this.sprite}}class a extends i{constructor(e){super(e,20,vec2(1,1.5),vec2(32,48)),this.weapon=new s,this.animation_frame=0,this.sprite_frame=0,this.bullets=[],this.shoot_counter=0,this.addChild(this.weapon,vec2(1,.5),0)}update(){super.update();const e=isUsingGamepad?gamepadStick(0):vec2((this.pos.x<tileCollisionSize.x/2+24-1?Number(keyIsDown(39)):0)-(this.pos.x>25?Number(keyIsDown(37)):0),(this.pos.y<tileCollisionSize.y/2+12-1?Number(keyIsDown(38)):0)-(this.pos.y>13.75?Number(keyIsDown(40)):0));0!=e.distance(vec2(0,0))?this.velocity=e.normalize().divide(vec2(13,13)):this.velocity=vec2(0,0),this.weapon.setTarget(mousePos),this.shoot_counter>0&&this.shoot_counter++,this.shoot_counter>=this.weapon.shoot_cooldown&&(this.shoot_counter=0),0==this.shoot_counter&&mouseIsDown(0)&&(this.bullets.push(this.weapon.shoot()),this.shoot_counter++),this.bullets.forEach((e=>{time-e.spawnTime>.5&&!e.destroyed&&e.destroy()}))}render(){super.render(),this.animation_frame%25==0&&(this.sprite_frame++,this.sprite_frame>2&&(this.sprite_frame=0)),this.animation_frame++,this.tileIndex=32+this.sprite_frame}}onerror=(...e)=>alert(e),e.player=void 0;const l=[],n=[];function r(e,t,s){const i=t.multiply(vec2(2,2));e.setData(i.add(vec2(0,0)),new TileLayerData(2*s+32,0)),e.setData(i.add(vec2(1,0)),new TileLayerData(2*s+33,0)),e.setData(i.add(vec2(0,1)),new TileLayerData(2*s+0,0)),e.setData(i.add(vec2(1,1)),new TileLayerData(2*s+1,0))}let h=0,c=0;let p=vec2(NaN,NaN);return engineInit((function(){initTileCollision(vec2(96,48));const t=new TileLayer(vec2(),tileCollisionSize);mainContext.drawImage(tileImage,0,0);for(let e=0;e<tileCollisionSize.x/2-2;e++){r(t,vec2(1+e,0),38),r(t,vec2(1+e,tileCollisionSize.y/2-1),38);for(let s=0;s<tileCollisionSize.y/2-2;s++){const i=randInt(6);r(t,vec2(1+e,1+s),64+i)}}for(let e=0;e<tileCollisionSize.y/2-2;e++)r(t,vec2(0,1+e),36),r(t,vec2(tileCollisionSize.y-1,1+e),37);r(t,vec2(0,0),32),r(t,vec2(0,tileCollisionSize.y/2-1),33),r(t,vec2(tileCollisionSize.x/2-1,0),34),r(t,vec2(tileCollisionSize.x/2-1,tileCollisionSize.y/2-1),35),t.scale=vec2(.5,.5),t.redraw(),t.pos=vec2(24,12),cameraScale=64;for(let e=0;e<30;e++)n.push(new o(vec2(tileCollisionSize.x/2+randInt(0,30)-15,tileCollisionSize.y/2+randInt(0,30)-15),0));e.player=new a(vec2(tileCollisionSize.x/2,tileCollisionSize.y/2))}),(function(){l.forEach(((t,s)=>time-t.spawnTime>.5&&!t.destroyed?(t.destroy(),void l.splice(s,1)):Math.abs(t.pos.x-e.player.pos.x)<.4&&Math.abs(t.pos.y-e.player.pos.y)<.4?(e.player.damage(1),t.destroy(),void l.splice(s,1)):void 0)),e.player.destroyed&&(paused=1),n.forEach(((t,s)=>{let i=1,o=vec2();for(const e of n)e!=t&&t.pos.distance(e.pos)<i&&(i=t.pos.distance(e.pos),o=e.pos);i<1?t.isTooClose(!0,o):t.isTooClose(!1,o),e.player.bullets.forEach(((s,i)=>{s.destroyed||Math.abs(s.pos.x-t.pos.x)<.5&&Math.abs(s.pos.y-t.pos.y)<.5&&(t.damage(1),s.destroy(),e.player.bullets.splice(i,1))})),t.destroyed&&(c++,n.splice(s,1))})),h%20==0&&n.length<50&&n.push(new o(vec2(tileCollisionSize.x/2+randInt(0,30)-15,tileCollisionSize.y/2+randInt(0,30)-15),0)),h++}),(function(){}),(function(){isNaN(p.x)&&isNaN(p.y)&&(p=e.player.pos),p=p.lerp(e.player.pos.subtract(e.player.velocity.multiply(vec2(5,5))),.04),cameraPos=p,drawTextScreen(`Time: ${Math.floor(time/60%60)}:${Math.floor(time%60).toString().padStart(2,"0")}\nHealth: ${e.player.health}\nKills: ${c}`,vec2(15,30),30,new Color,100,new Color(0,0,0,0),"left"),paused&&drawTextScreen("You Died!\nReload to try again",vec2(window.innerWidth/2,window.innerHeight/2-50),100,new Color(1,0,0,1))}),(function(){}),"media/tiles.png"),e.enemy_bullets=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
